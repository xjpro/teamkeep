
<!-- ko if: Messages().length == 0 -->
<div class="text-center">
    <p>
        No messages have been recorded
    </p>
</div>
<!-- /ko -->
<ul class="newsfeed">
    
    <!-- ko foreach: Messages -->
    <li>
        <i class="icon-envelope icon-2x"></i> 
        <article>
            <h6>
                <a data-toggle="tab" href="#log-message" data-bind="text: Subject, click: function () { teamViewModel.SelectedMessage($data); }" ></a>
            </h6>
            <time data-bind="text: TimePast"></time>
            <p data-bind="html: AbbrevContent"></p>
        </article>
    </li>
    <!-- /ko -->
</ul>
<script>
    var MessagesViewModel = function() {
        var me = this;

        this.Editable = teamViewModel.Editable;
        this.Url = teamViewModel.Url;
        this.Messages = teamViewModel.Messages;

        me.Messages.sort(function (a, b) {
            var aMoment = moment(a.DateTime());
            var bMoment = moment(b.DateTime());
            if (aMoment.isAfter(bMoment)) return -1;
            if (aMoment.isBefore(bMoment)) return 1;
            return 0;
        });

        this.RemoveMessage = function (message) {
            $.ajax({
                type: "DELETE", url: me.Url() + "/messages",
                contentType: "application/json",
                data: JSON.stringify({
                    Message: {
                        Id: message.Id()
                    }
                }),
                complete: function () {
                    me.Messages.remove(message);
                }
            });
        };
    };

    $(function () {
        window.messagesViewModel = new MessagesViewModel();
        ko.applyBindings(window.messagesViewModel, document.getElementById("messages"));
    });
</script>
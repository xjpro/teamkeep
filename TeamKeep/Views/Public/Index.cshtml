@{
    Layout = "~/Views/Shared/PublicMaster.cshtml";
    ViewBag.Title = "Free Online Sports Team Manager";
    ViewBag.Description = "Manage your sports team online for free with Team Keep. Captains and coaches can organize their team's games, practices, and roster with our easy to learn interface. Keep your team up to date with a public page they can view from any device.";
}
<div id="front-header" class="row-fluid">
    <div class="span6">
        <ul class="nav nav-pills">
            <li>
                <a href="/about">About</a>
            </li>
        </ul>
    </div>
    <div class="span6 text-right">
        New to Team Keep? <button id="register-button" class="btn btn-info" data-toggle="modal" data-target="#register-modal">Create an account</button>    
    </div>
</div>
<div class="row-fluid showcase">
    <div class="span7 hidden-phone">
        <h1><img src="/img/logo.png" alt="Team Keep" /></h1>
        <p>
            Managing a sports team has never been easier. Team Keep organizes your team's schedules and rosters so you can spend more time enjoying your sport. 
            It's absolutely <em>free</em>, takes just seconds to setup, and is incredibly simple to use.
        </p>
        <p>
            <a data-toggle="modal" data-target="#register-modal">Get started now</a>
        </p>
    </div>
    <div id="login" class="span5">
        <h4>Sign in</h4>
        <div class="alert alert-error hide">
            <span></span>
        </div>
            
        <form data-bind="submit: LoginUser">
            <input id="input-email" type="email" placeholder="Email" data-bind="value: Email" />
            <input id="input-password" type="password" placeholder="Password" data-bind="value: Password" />
            <div>
                <button class="btn btn-success">
                    <i class="icon-refresh icon-spin"></i> Sign in <i class="icon-lock"></i>
                </button>
                <a class="btn btn-link" data-toggle="modal" data-target="#reset-modal">Forgot your password?</a>
            </div>
        </form>
    </div>
</div>
<div class="row-fluid nonshowcase">
    <div class="span5">
        <h3>Intuitive Interface</h3>
        <p>
            No manual required! Edit on the fly by simply clicking fields you'd like to change &mdash; changes are uploaded and saved automatically. 
        </p>
        <p>
            Schedule and roster tables are easy to use and adapt to your needs. You can sort on any columns or turn off those you don't need.
        </p>
    </div>
    <div class="span7">
        <img src="/img/promo1.png" alt="Team Keep interface"/>
    </div>
</div>
<div class="row-fluid nonshowcase">
    <div class="span5">
        <h3>Team Home Page</h3>
        <p>
            Publish an online site for your team. With our privacy controls you control what is visible 
            to the public. Your team stays up to date with a central location for announcements and updated schedule information. 
        </p>
        <p>
            Throw out the paperwork! Everything you need to manage is now all in one place, automatically organized, where your team can view it anytime.
        </p>
    </div>
    <div class="span7">
        <img src="/img/promo2.png" alt="Team Keep team pages"/>
    </div>
</div>
<div class="row-fluid nonshowcase">
    <div class="span5">
        <h3>Responsive Design</h3>
        <p>
            Access our site from your phone or tablet &mdash; the responsive interface automatically resizes to accomodate any screen size. 
            Make updates anytime, anywhere.
        </p>
    </div>
    <div class="span7">
        <img src="/img/promo3.png" alt="Team Keep rsesponsive design"/>
    </div>
</div>
<div class="row-fluid">
    <div class="span12">
        <p class="text-center">
            Get started with Team Keep
        </p>
        <p class="text-center">
            <button class="btn btn-info btn-large" data-toggle="modal" data-target="#register-modal">Sign up now</button>
        </p>
    </div>
</div>
<form id="register-modal" class="modal hide fade" data-bind="submit: RegisterUser">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Create an account</h3>
    </div>
    <div class="modal-body">
        <div class="alert alert-error hide">
            <span></span>
        </div>
        <div>
            <label>Email:</label>
            <input type="email" placeholder="" data-bind="value: RegisterEmail"/>
            <span class="help-block">Your email will never be sold or used for advertisements</span>
        </div>
        <div>
            <label>Password:</label>
            <input type="password" placeholder="" data-bind="value: RegisterPassword"/>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn" type="button" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <button class="btn btn-success">
            <i class="icon-refresh icon-spin"></i> Sign up now
        </button>
    </div>
</form>
<form id="reset-modal" class="modal hide fade" data-bind="submit: ResetPassword">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Password reset</h3>
    </div>
    <div class="modal-body">
        <div class="alert alert-error hide">
            <span></span>
        </div>
        <div>
            <label>Email:</label>
            <input type="email" placeholder="" data-bind="value: Email"/>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn" type="button" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <button class="btn btn-success">
            <i class="icon-refresh icon-spin"></i> Send reset e-mail
        </button>
    </div>
</form>
<script>
    $(function () {
        
        var RegistrationViewModel = function(data) {
            var me = this;
            ko.mapping.fromJS(data, {}, me);

            me.Email = ko.observable("");
            me.Password = ko.observable("");
            me.RegisterEmail = ko.observable("");
            me.RegisterPassword = ko.observable("");
            
            me.LoginUser = function () {
                
                if (me.Email().length < 6) {
                    $("#login .alert span").html("Please enter your e-mail address").parent().show();
                    return;
                }
                if (me.Password().length < 3) {
                    $("#login .alert span").html("Please enter your password").parent().show();
                    return;
                }
                
                $("#login button").prop("disabled", true);
                $("#login .icon-spin").show();

                $.ajax({
                    type: "POST", url: "/login",
                    data: JSON.stringify({ Email: me.Email(), Password: me.Password() }),
                    contentType: "application/json",
                    success: function (response) {
                        TeamKeep.signIn(response.AuthToken, response.Redirect);
                    },
                    error: function (response) {
                        try {
                            $("#login .alert span").html(JSON.parse(response.responseText)).parent().show();
                        } catch (e) {
                            $("#login .alert span").html("Login failed").parent().show();
                        }
                        $("#login button").prop("disabled", false);
                        $("#login .icon-spin").hide();
                    }
                });
            };
            me.RegisterUser = function() {

                if (me.RegisterEmail().length < 6) {
                    $("#register-modal .alert span").html("Please enter a valid e-mail address").parent().show();
                    return;
                }

                if (me.RegisterPassword().length < 3) {
                    $("#register-modal .alert span").html("Please enter a password").parent().show();
                    return;
                }

                $("#register-modal button").prop("disabled", true);
                $("#register-modal .icon-spin").show();

                $.ajax({
                    type: "POST", url: "/users",
                    data: { Email: me.RegisterEmail(), Password: me.RegisterPassword() },
                    success: function (response) {
                        TeamKeep.signIn(response.AuthToken, response.Redirect);
                    },
                    error: function (response) {
                        $("#register-modal .alert span").html(JSON.parse(response.responseText)).parent().show();
                        $("#register-modal button").prop("disabled", false);
                        $("#register-modal .icon-spin").hide();
                    }
                });
            };
            me.ResetPassword = function () {
                
                if (me.Email().length < 6) {
                    $("#reset-modal .alert span").html("Please enter your e-mail address").parent().show();
                    return;
                }

                $("#reset-modal .icon-spin").show();
                $("#reset-modal button").prop("disabled", true);
                $.ajax({
                    type: "POST", url: "/users/password",
                    data: {
                        Email: me.Email()
                    },
                    success: function () {
                        document.location = "/resetsent";
                    },
                    error: function (response) {
                        $("#reset-modal .alert span").html(JSON.parse(response.responseText)).parent().show();
                        $("#reset-modal .icon-spin").hide();
                        $("#reset-modal button").prop("disabled", false);
                    }
                });
            };
        };

        window.viewModel = ko.mapping.fromJS({}, ko.mapping.toViewModel(RegistrationViewModel));
        ko.applyBindings(window.viewModel);
        
        if (new RegExp("register=true").test(location.search)) {
            $("#register-button").click();
        } else {
            $("#input-email").focus();
        }
    });

</script>